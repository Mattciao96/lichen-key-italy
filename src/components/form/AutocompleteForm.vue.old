<template>
  <div>
    <AutoComplete v-model="value" :suggestions="filteredItems" @complete="search" />
  </div>
</template>

<script setup>
import AutoComplete from 'primevue/autocomplete'
import { computed, ref } from 'vue'

let value = ref('')
let items = ref([])
let filteredItems = computed(() => {
  if (value.value === '') {
    return []
  }
  return items.value.filter((item) => item.toLowerCase().includes(value.value.toLowerCase()))
})
let dataFetched = ref(false)

const search = async (event) => {
  if (!dataFetched.value && event.query.length > 0) {
    try {
      const response = await fetch('https://italic.units.it/api/v1/genera')
      const data = await response.json()

      items.value = data
      dataFetched.value = true
    } catch (error) {
      console.error('Failed to fetch data:', error)
    }
  }
}
</script>
